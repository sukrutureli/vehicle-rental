<!DOCTYPE html>
<html>
<head>
    <title>Vehicles</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { margin-bottom: 20px; }
        .form-row { margin: 8px 0; }
        label { display: inline-block; width: 120px; font-weight: bold; }
        input, select { padding: 5px; width: 200px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #999; padding: 6px; }
        th { background-color: #eee; }
    </style>
</head>
<body>
<h2>Add Vehicle</h2>

<!-- Ekleme Formu -->
<form onsubmit="addVehicle(); return false;">
    <div class="form-row">
        <label>Brand:</label>
        <input type="text" id="brand" required/>
    </div>
    <div class="form-row">
        <label>Model:</label>
        <input type="text" id="model" required/>
    </div>
    <div class="form-row">
        <label>City:</label>
        <input type="text" id="city" required/>
    </div>
    <div class="form-row">
        <label>Plate:</label>
        <input type="text" id="plate" required/>
    </div>
    <div class="form-row">
        <label>Price:</label>
        <input type="number" id="dailyPrice" required/>
    </div>
    <div class="form-row">
        <label>Fuel Type:</label>
        <select id="fuelType" required>
	        <option value="GASOLINE">GASOLINE</option>
	        <option value="DIESEL">DIESEL</option>
	        <option value="ELECTRIC">ELECTRIC</option>
	        <option value="HYBRID">HYBRID</option>
	    </select>
    </div>
    <div class="form-row">
        <label>Transmission:</label>
        <select id="transmission" required>
	        <option value="MANUAL">MANUAL</option>
	        <option value="AUTOMATIC">AUTOMATIC</option>
	    </select>
    </div>
    <div class="form-row">
        <label>Status:</label>
        <select id="status" required>
	        <option value="AVAILABLE">AVAILABLE</option>
	        <option value="RENTED">RENTED</option>
	        <option value="MAINTENANCE">MAINTENANCE</option>
	    </select>
    </div>
    <div class="form-row">
        <label>Available From:</label>
        <input type="datetime-local" id="availableFrom" required/>
    </div>
    <div class="form-row">
        <label>Available To:</label>
        <input type="datetime-local" id="availableTo" required/>
    </div>
    <button type="submit">Add Vehicle</button>
</form>

<hr/>

<h2>Filter Vehicles</h2>
<form onsubmit="filterVehicles(); return false;">
    <div>
        <label>Brand:</label>
        <input type="text" id="filterBrand"/>
    </div>
    <div>
        <label>Model:</label>
        <input type="text" id="filterModel"/>
    </div>
    <div>
        <label>City:</label>
        <input type="text" id="filterCity"/>
    </div>
    <div>
        <label>Fuel Type:</label>
        <select id="filterFuelType">
            <option value="">--Any--</option>
            <option value="GASOLINE">GASOLINE</option>
            <option value="DIESEL">DIESEL</option>
            <option value="ELECTRIC">ELECTRIC</option>
            <option value="HYBRID">HYBRID</option>
        </select>
    </div>
    <div>
        <label>Transmission:</label>
        <select id="filterTransmission">
            <option value="">--Any--</option>
            <option value="MANUAL">MANUAL</option>
            <option value="AUTOMATIC">AUTOMATIC</option>
        </select>
    </div>
    <div>
        <label>Status:</label>
        <select id="filterStatus">
            <option value="">--Any--</option>
            <option value="AVAILABLE">AVAILABLE</option>
            <option value="RENTED">RENTED</option>
            <option value="MAINTENANCE">MAINTENANCE</option>
        </select>
    </div>
    <div>
        <label>Min Price:</label>
        <input type="number" id="filterMinPrice"/>
    </div>
    <div>
        <label>Max Price:</label>
        <input type="number" id="filterMaxPrice"/>
    </div>
    <div>
        <label>Available From:</label>
        <input type="datetime-local" id="filterFrom"/>
    </div>
    <div>
        <label>Available To:</label>
        <input type="datetime-local" id="filterTo"/>
    </div>
    <button type="submit">Filter</button>
</form>


<hr/>

<h2>Vehicles List</h2>
<!-- Araç Listesi -->
<table>
    <thead>
    <tr>
        <th>Brand</th><th>Model</th><th>City</th><th>Plate</th>
        <th>Price</th><th>Fuel</th><th>Transmission</th><th>Status</th>
        <th>Available From</th><th>Available To</th><th>Created</th><th>Updated</th><th>Actions</th>
    </tr>
    </thead>
    <tbody id="vehiclesTable"></tbody>
</table>

<a href="/">Back to Index</a>

<script>
async function loadVehicles() {
    const response = await fetch('/api/vehicles');
    const data = await response.json();

    const table = document.getElementById('vehiclesTable');
    table.innerHTML = '';

    data.forEach(v => {
        const row = `<tr>
            <td>${v.brand}</td>
            <td>${v.model}</td>
            <td>${v.city}</td>
            <td>${v.plate}</td>
            <td>${v.dailyPrice}</td>
            <td>${v.fuelType}</td>
            <td>${v.transmission}</td>
            <td>${v.status}</td>
            <td>${v.availableFrom || ''}</td>
            <td>${v.availableTo || ''}</td>
            <td>${v.createdAt || ''}</td>
            <td>${v.updatedAt || ''}</td>
            <td>
                <a href="/vehicles/edit?id=${v.id}">Edit</a> 
                <button onclick="deleteVehicle('${v.id}')">Delete</button>
                <button onclick="loadLocation('${v.id}')">Location</button>
            </td>
        </tr>`;
        table.innerHTML += row;
    });
}

async function addVehicle() {
    const vehicle = {
        brand: document.getElementById('brand').value,
        model: document.getElementById('model').value,
        city: document.getElementById('city').value,
        plate: document.getElementById('plate').value,
        dailyPrice: document.getElementById('dailyPrice').value,
        fuelType: document.getElementById('fuelType').value,
        transmission: document.getElementById('transmission').value,
        status: document.getElementById('status').value,
        availableFrom: document.getElementById('availableFrom').value,
        availableTo: document.getElementById('availableTo').value
    };

    await fetch('/api/vehicles', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(vehicle)
    });

    loadVehicles();
}

async function deleteVehicle(id) {
    await fetch(`/api/vehicles/${id}`, { method: 'DELETE' });
    loadVehicles();
}

async function loadLocation(vehicleId) {
    const response = await fetch(`/api/vehicles/${vehicleId}/location/latest`);
    if (response.ok) {
        const loc = await response.json();
        alert(`Vehicle ${vehicleId}\nLat: ${loc.lat}, Lon: ${loc.lon}, Time: ${loc.reportedAt}`);
    } else {
        alert("No location found for this vehicle.");
    }
}

async function filterVehicles() {
    const params = new URLSearchParams();

    if (document.getElementById('filterBrand').value)
        params.append("brand", document.getElementById('filterBrand').value);

    if (document.getElementById('filterModel').value)
        params.append("model", document.getElementById('filterModel').value);

    if (document.getElementById('filterCity').value)
        params.append("city", document.getElementById('filterCity').value);

    if (document.getElementById('filterFuelType').value)
        params.append("fuelType", document.getElementById('filterFuelType').value);

    if (document.getElementById('filterTransmission').value)
        params.append("transmission", document.getElementById('filterTransmission').value);

    if (document.getElementById('filterStatus').value)
        params.append("status", document.getElementById('filterStatus').value);

    if (document.getElementById('filterMinPrice').value)
        params.append("minPrice", document.getElementById('filterMinPrice').value);

    if (document.getElementById('filterMaxPrice').value)
        params.append("maxPrice", document.getElementById('filterMaxPrice').value);

    if (document.getElementById('filterFrom').value)
        params.append("availableFrom", document.getElementById('filterFrom').value);

    if (document.getElementById('filterTo').value)
        params.append("availableTo", document.getElementById('filterTo').value);

    const response = await fetch('/api/vehicles?' + params.toString());
    const data = await response.json();

    const table = document.getElementById('vehiclesTable');
    table.innerHTML = '';

    data.forEach(v => {
        const row = `<tr>
            <td>${v.brand}</td>
            <td>${v.model}</td>
            <td>${v.city}</td>
            <td>${v.plate}</td>
            <td>${v.dailyPrice}</td>
            <td>${v.fuelType}</td>
            <td>${v.transmission}</td>
            <td>${v.status}</td>
            <td>${v.availableFrom || ''}</td>
            <td>${v.availableTo || ''}</td>
            <td>${v.createdAt || ''}</td>
            <td>${v.updatedAt || ''}</td>
            <td>
	            <a href="/vehicles/edit?id=${v.id}">Edit</a> 
	            <button onclick="deleteVehicle('${v.id}')">Delete</button>
	            <button onclick="loadLocation('${v.id}')">Location</button>
	        </td>
        </tr>`;
        table.innerHTML += row;
    });
}


window.onload = loadVehicles;
</script>
</body>
</html>
