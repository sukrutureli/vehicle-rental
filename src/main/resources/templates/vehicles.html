<!DOCTYPE html>
<html>
<head>
    <title>Vehicles</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { margin-bottom: 20px; }
        .form-row { margin: 8px 0; }
        label { display: inline-block; width: 120px; font-weight: bold; }
        input, select { padding: 5px; width: 200px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #999; padding: 6px; }
        th { background-color: #eee; }
    </style>
</head>
<body>
<h1>Vehicle List</h1>

<!-- Ekleme Formu -->
<form onsubmit="addVehicle(); return false;">
    <div class="form-row">
        <label>Brand:</label>
        <input type="text" id="brand" required/>
    </div>
    <div class="form-row">
        <label>Model:</label>
        <input type="text" id="model" required/>
    </div>
    <div class="form-row">
        <label>City:</label>
        <input type="text" id="city" required/>
    </div>
    <div class="form-row">
        <label>Plate:</label>
        <input type="text" id="plate" required/>
    </div>
    <div class="form-row">
        <label>Price:</label>
        <input type="number" id="dailyPrice" required/>
    </div>
    <div class="form-row">
        <label>Fuel Type:</label>
        <select id="fuelType" required>
	        <option value="GASOLINE">GASOLINE</option>
	        <option value="DIESEL">DIESEL</option>
	        <option value="ELECTRIC">ELECTRIC</option>
	        <option value="HYBRID">HYBRID</option>
	    </select>
    </div>
    <div class="form-row">
        <label>Transmission:</label>
        <select id="transmission" required>
	        <option value="MANUAL">MANUAL</option>
	        <option value="AUTOMATIC">AUTOMATIC</option>
	    </select>
    </div>
    <div class="form-row">
        <label>Status:</label>
        <select id="status" required>
	        <option value="AVAILABLE">AVAILABLE</option>
	        <option value="RENTED">RENTED</option>
	        <option value="MAINTENANCE">MAINTENANCE</option>
	    </select>
    </div>
    <button type="submit">Add Vehicle</button>
</form>

<hr/>

<!-- Araç Listesi -->
<table>
    <thead>
    <tr>
        <th>ID</th><th>Brand</th><th>Model</th><th>City</th><th>Plate</th>
        <th>Price</th><th>Fuel</th><th>Transmission</th><th>Status</th>
        <th>Created</th><th>Updated</th><th>Actions</th>
    </tr>
    </thead>
    <tbody id="vehiclesTable"></tbody>
</table>

<a href="/">Back to Index</a>

<script>
async function loadVehicles() {
    const response = await fetch('/vehicles/api');
    const data = await response.json();

    const table = document.getElementById('vehiclesTable');
    table.innerHTML = '';

    data.forEach(v => {
        const row = `<tr>
            <td>${v.id}</td>
            <td>${v.brand}</td>
            <td>${v.model}</td>
            <td>${v.city}</td>
            <td>${v.plate}</td>
            <td>${v.dailyPrice}</td>
            <td>${v.fuelType}</td>
            <td>${v.transmission}</td>
            <td>${v.status}</td>
            <td>${v.createdAt || ''}</td>
            <td>${v.updatedAt || ''}</td>
            <td>
                <a href="/vehicles/edit?id=${v.id}">Edit</a> 
                <button onclick="deleteVehicle('${v.id}')">Delete</button>
                <button onclick="loadLocation('${v.id}')">Location</button>
            </td>
        </tr>`;
        table.innerHTML += row;
    });
}

async function addVehicle() {
    const vehicle = {
        brand: document.getElementById('brand').value,
        model: document.getElementById('model').value,
        city: document.getElementById('city').value,
        plate: document.getElementById('plate').value,
        dailyPrice: document.getElementById('dailyPrice').value,
        fuelType: document.getElementById('fuelType').value,
        transmission: document.getElementById('transmission').value,
        status: document.getElementById('status').value
    };

    await fetch('/vehicles/api', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(vehicle)
    });

    loadVehicles();
}

async function deleteVehicle(id) {
    await fetch(`/vehicles/api/${id}`, { method: 'DELETE' });
    loadVehicles();
}

async function loadLocation(vehicleId) {
    const response = await fetch(`/api/vehicles/${vehicleId}/location/latest`);
    if (response.ok) {
        const loc = await response.json();
        alert(`Vehicle ${vehicleId}\nLat: ${loc.lat}, Lon: ${loc.lon}, Time: ${loc.reportedAt}`);
    } else {
        alert("No location found for this vehicle.");
    }
}

window.onload = loadVehicles;
</script>
</body>
</html>
