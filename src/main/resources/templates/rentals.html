<!DOCTYPE html>
<html>
<head>
    <title>Rentals</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        form div { margin-bottom: 8px; }
        label { display: inline-block; width: 120px; font-weight: bold; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    </style>
</head>
<body>
<h2>Add Rental</h2>

<!-- Ekleme Formu -->
<form onsubmit="addRental(); return false;">
    <div>
        <label>Vehicle Plate:</label>
        <input type="text" id="vehiclePlate" required/>
    </div>
    <div>
        <label>Customer Email:</label>
        <input type="text" id="customerEmail" required/>
    </div>
    <div>
        <label>Start Date:</label>
        <input type="datetime-local" id="startDate" required/>
    </div>
    <div>
        <label>End Date:</label>
        <input type="datetime-local" id="endDate" required/>
    </div>
    <div>
        <label>Status:</label>
        <select id="status" required>
	        <option value="ACTIVE">ACTIVE</option>
	        <option value="COMPLETED">COMPLETED</option>
	        <option value="CANCELLED">CANCELLED</option>
	    </select>
    </div>
    <button type="submit">Add Rental</button>
</form>

<hr/>

<h2>Filter Rentals</h2>

<form onsubmit="filterRentals(); return false;">
    <div>
        <label>Vehicle Plate:</label>
        <input type="text" id="filterPlate"/>
    </div>
    <div>
        <label>Customer Email:</label>
        <input type="text" id="filterEmail"/>
    </div>
    <div>
        <label>Status:</label>
        <select id="filterStatus">
            <option value="">--Any--</option>
            <option value="ACTIVE">ACTIVE</option>
            <option value="COMPLETED">COMPLETED</option>
            <option value="CANCELLED">CANCELLED</option>
        </select>
    </div>
    <div>
        <label>Start From:</label>
        <input type="datetime-local" id="filterStartedFrom"/>
    </div>
    <div>
        <label>End To:</label>
        <input type="datetime-local" id="filterEndedTo"/>
    </div>
    <button type="submit">Filter</button>
</form>

<hr/>

<h2>Rentals List</h2>
<!-- Liste -->
<table>
    <thead>
        <tr>
            <th>Vehicle Plate</th>
            <th>Customer Email</th>
            <th>Start</th>
            <th>End</th>
            <th>Status</th>
            <th>Created</th>
            <th>Updated</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="rentalsTable"></tbody>
</table>

<hr/>
<a href="/">Back to Index</a>

<script>
async function loadRentals() {
    const response = await fetch('/api/rentals');
    const data = await response.json();

    const table = document.getElementById('rentalsTable');
    table.innerHTML = '';

    data.forEach(r => {
        const row = `<tr>
            <td>${r.vehiclePlate}</td>
            <td>${r.customerEmail}</td>
            <td>${r.startDate || ''}</td>
            <td>${r.endDate || ''}</td>
            <td>${r.status}</td>
            <td>${r.createdAt || ''}</td>
            <td>${r.updatedAt || ''}</td>
            <td>
	            <button onclick="completeRental('${r.id}')">Complete</button>
	            <button onclick="cancelRental('${r.id}')">Cancel</button>
	        </td>
        </tr>`;
        table.innerHTML += row;
    });
}

async function addRental() {
    const rental = {
        vehiclePlate: document.getElementById('vehiclePlate').value,
        customerEmail: document.getElementById('customerEmail').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        status: document.getElementById('status').value
    };

    await fetch('/api/rentals', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(rental)
    });

    loadRentals();
}

async function filterRentals() {
    const params = new URLSearchParams();

    if (document.getElementById('filterPlate').value)
        params.append("vehiclePlate", document.getElementById('filterPlate').value);

    if (document.getElementById('filterEmail').value)
        params.append("customerEmail", document.getElementById('filterEmail').value);

    if (document.getElementById('filterStatus').value)
        params.append("status", document.getElementById('filterStatus').value);

    if (document.getElementById('filterStartedFrom').value)
        params.append("startDate", document.getElementById('filterStartedFrom').value);

    if (document.getElementById('filterEndedTo').value)
        params.append("endDate", document.getElementById('filterEndedTo').value);

    const response = await fetch(`/api/rentals?${params.toString()}`);
    const data = await response.json();

    const table = document.getElementById('rentalsTable');
    table.innerHTML = '';

    data.forEach(r => {
        const row = `<tr>
            <td>${r.vehiclePlate}</td>
            <td>${r.customerEmail}</td>
            <td>${r.startDate || ''}</td>
            <td>${r.endDate || ''}</td>
            <td>${r.status}</td>
            <td>${r.createdAt || ''}</td>
            <td>${r.updatedAt || ''}</td>
            <td>
	            <button onclick="completeRental('${r.id}')">Complete</button>
	            <button onclick="cancelRental('${r.id}')">Cancel</button>
	        </td>
        </tr>`;
        table.innerHTML += row;
    });
    
}

async function completeRental(id) {
    await fetch(`/api/rentals/${id}/complete`, { method: 'PUT' });
    loadRentals();
}

async function cancelRental(id) {
    await fetch(`/api/rentals/${id}/cancel`, { method: 'PUT' });
    loadRentals();
}

window.onload = loadRentals;
</script>
</body>
</html>
